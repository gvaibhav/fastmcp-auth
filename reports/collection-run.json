{
  "info": {
    "name": "Time MCP Server - Quick Run",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": "1.0.0",
    "description": "Minimal collection for automated runs (newman). Ensure reports/newman-env.json exists with code_verifier/code_challenge/authorization_code/access_token/refresh_token before running."
  },
  "item": [
    {
      "name": "Discovery - AS Metadata",
      "request": {
        "method": "GET",
        "header": [],
        "url": "http://localhost:8000/.well-known/oauth-authorization-server"
      },
      "event": [{"listen":"test","script":{"exec":["pm.test('Status 200', ()=> pm.response.to.have.status(200));"]}}]
    },
    {
      "name": "Discovery - OpenID Config",
      "request": {"method":"GET","header":[],"url":"http://localhost:8000/.well-known/openid-configuration"},
      "event": [{"listen":"test","script":{"exec":["pm.test('Status 200', ()=> pm.response.to.have.status(200));"]}}]
    },
    {
      "name": "Discovery - Protected Resource",
      "request": {"method":"GET","header":[],"url":"http://localhost:3000/.well-known/oauth-protected-resource"},
      "event": [{"listen":"test","script":{"exec":["pm.test('Status 200', ()=> pm.response.to.have.status(200));"]}}]
    },
    {
      "name": "OAuth - Authorize (Get Code)",
      "request": {
        "method": "GET",
        "header": [],
        "url": "http://localhost:8000/oauth/authorize?response_type=code&client_id={{client_id}}&redirect_uri={{redirect_uri}}&scope={{scope}}&code_challenge={{code_challenge}}&code_challenge_method=S256&state=state123"
      },
      "event": [{"listen":"test","script":{"exec":[
        "pm.test('status 200', ()=> pm.response.to.have.status(200));",
        "var body = pm.response.text();",
  "var m = body.match(/code=([A-Za-z0-9_-]+)/) || body.match(/Authorization Code:[^<]*>([A-Za-z0-9_-]{20,})/) || body.match(/<div class=\\\"code\\\">\\s*([A-Za-z0-9_-]{20,})/i);",
  "if (m && m[1]) { pm.environment.set('authorization_code', m[1]); console.log('saved code', m[1]); } else { console.log('no code found'); }"
      ]}}]
    },
    {
      "name": "OAuth - Token Exchange",
      "request": {
        "method": "POST",
        "header": [{"key":"Content-Type","value":"application/x-www-form-urlencoded"}],
        "body": {"mode":"urlencoded","urlencoded":[
          {"key":"grant_type","value":"authorization_code","type":"text"},
          {"key":"code","value":"{{authorization_code}}","type":"text"},
          {"key":"client_id","value":"{{client_id}}","type":"text"},
          {"key":"code_verifier","value":"{{code_verifier}}","type":"text"},
          {"key":"redirect_uri","value":"{{redirect_uri}}","type":"text"}
        ]},
        "url": "http://localhost:8000/oauth/token"
      },
      "event": [{"listen":"test","script":{"exec":[
        "pm.test('status 200', ()=> pm.response.to.have.status(200));",
  "var js = pm.response.json();",
  "if (js.access_token) pm.environment.set('access_token', js.access_token);",
  "if (js.refresh_token) pm.environment.set('refresh_token', js.refresh_token);",
  "console.log('token saved');"
      ]}}]
    },
    {
      "name": "MCP - Get Current Time (valid token)",
      "request": {"method":"POST","header":[{"key":"Content-Type","value":"application/json"},{"key":"Authorization","value":"Bearer {{access_token}}"}],"body":{"mode":"raw","raw":"{\n  \"timezone\": \"UTC\"\n}"},"url":"http://localhost:3000/tools/get_current_time"},
      "event": [{"listen":"test","script":{"exec":["pm.test('status 200', ()=> pm.response.to.have.status(200));"]}}]
    },
    {
      "name": "MCP - Convert Time (valid token)",
      "request": {"method":"POST","header":[{"key":"Content-Type","value":"application/json"},{"key":"Authorization","value":"Bearer {{access_token}}"}],"body":{"mode":"raw","raw":"{\n  \"source_timezone\": \"UTC\",\n  \"time\": \"14:30\",\n  \"target_timezone\": \"America/New_York\"\n}"},"url":"http://localhost:3000/tools/convert_time"},
      "event": [{"listen":"test","script":{"exec":["pm.test('status 200', ()=> pm.response.to.have.status(200));"]}}]
    },
    {
      "name": "MCP - Get Current Time (no token)",
      "request": {"method":"POST","header":[{"key":"Content-Type","value":"application/json"}],"body":{"mode":"raw","raw":"{\n  \"timezone\": \"UTC\"\n}"},"url":"http://localhost:3000/tools/get_current_time"},
      "event": [{"listen":"test","script":{"exec":["pm.test('status 401', ()=> pm.response.to.have.status(401));"]}}]
    },
    {
      "name": "MCP - Get Current Time (invalid token)",
      "request": {"method":"POST","header":[{"key":"Content-Type","value":"application/json"},{"key":"Authorization","value":"Bearer invalid_token_12345"}],"body":{"mode":"raw","raw":"{\n  \"timezone\": \"UTC\"\n}"},"url":"http://localhost:3000/tools/get_current_time"},
      "event": [{"listen":"test","script":{"exec":["pm.test('status 401', ()=> pm.response.to.have.status(401));"]}}]
    },
    { "name": "Health Check", "request": {"method":"GET","header":[],"url":"http://localhost:3000/health"} },
    { "name": "Server Info", "request": {"method":"GET","header":[],"url":"http://localhost:3000/"} }
  ]
}
